
# Saaf Hawa Wiki

Welcome to the official wiki for the Saaf Hawa application. This document provides a comprehensive overview of the application's architecture, features, and technical implementation.

## 1. Introduction

Saaf Hawa is a Next.js web application designed to provide real-time air quality information, personalized health recommendations, and a suite of tools to promote environmental awareness and action, with an initial focus on users in Pakistan.

## 2. Technology Stack

- **Framework**: Next.js (with App Router)
- **Language**: TypeScript
- **UI Library**: React
- **Styling**: Tailwind CSS
- **UI Components**: ShadCN UI
- **Generative AI**: Firebase Genkit
- **Database**: Firebase Firestore
- **Authentication**: Firebase Authentication
- **Mapping**: Leaflet.js
- **Icons**: Lucide React
- **Deployment**: Firebase App Hosting

## 3. Project Structure

The project follows a standard Next.js App Router structure.

```
/
├── src/
│   ├── app/                    # Next.js App Router
│   │   ├── (app)/              # Authenticated routes
│   │   │   ├── dashboard/
│   │   │   ├── hazard-zones/
│   │   │   ├── recommendations/
│   │   │   └── ... (other app pages)
│   │   ├── api/                # API Routes (e.g., for proxying)
│   │   ├── layout.tsx          # Root layout
│   │   └── page.tsx            # Landing page
│   ├── ai/                     # Genkit AI flows
│   │   ├── flows/              # Individual AI flow definitions
│   │   └── genkit.ts           # Genkit configuration
│   ├── components/             # Reusable React components
│   │   ├── ui/                 # ShadCN UI components
│   │   ├── dashboard/
│   │   └── landing/
│   ├── firebase/               # Firebase configuration and hooks
│   │   ├── auth/
│   │   ├── firestore/
│   │   ├── client-provider.tsx # Client-side Firebase initializer
│   │   ├── config.ts           # Firebase project config
│   │   └── index.ts            # Barrel file for Firebase utilities
│   ├── hooks/                  # Custom React hooks
│   ├── lib/                    # Libraries, utilities, and static data
│   └── ...
├── docs/                       # Documentation (API usage, this wiki)
├── public/                     # Static assets
└── ... (config files)
```

## 4. Features

### 4.1. Dashboard (`/dashboard`)
- **Description**: Provides a real-time overview of the current Air Quality Index (AQI) for the user's location.
- **Implementation**:
    - `src/app/(app)/dashboard/page.tsx` is the main page component.
    - It uses the `useAirQualityData` hook (`src/hooks/useAirQualitydata.ts`) to fetch AQI data from the `/api/air-quality` endpoint, which proxies requests to the Open-Meteo API.
    - The user's location is determined using the browser's Geolocation API. A reverse geocoding lookup is performed via `/api/reverse-geo` to get the city name.
    - Displays a summary card (`AqiSummaryCard`), a grid of individual pollutants (`PollutantGrid`), and an AI-generated weekly insight (`AqiInsightCard`).
    - The weekly insight is generated by the `getAirQualityInsight` flow (`src/ai/flows/air-quality-insights.ts`).

### 4.2. Hazard Zones (`/hazard-zones`)
- **Description**: A live map displaying real-time environmental hazards.
- **Implementation**:
    - `src/app/(app)/hazard-zones/page.tsx` renders the `HazardMapClient` component.
    - `src/components/hazard-zones/HazardMapClient.tsx` uses Leaflet.js to create an interactive map.
    - It integrates multiple data sources as toggleable layers:
        - **Wildfires**: Fetches data from NASA FIRMS API.
        - **Weather**: Overlays for temperature, precipitation, clouds, and wind from OpenWeatherMap.
        - **Air Quality Stations**: Fetches station data from the OpenAQ API and plots them as AQI-colored markers.
    - API keys (`NEXT_PUBLIC_NASA_API_KEY`, `NEXT_PUBLIC_OPENWEATHER_API_KEY`, `NEXT_PUBLIC_OPENAQ_API_KEY`) are required in `.env` for full functionality.

### 4.3. Personalized Health Advice (`/recommendations`)
- **Description**: Offers AI-driven health recommendations based on the current AQI and a user's health profile.
- **Implementation**:
    - `src/app/(app)/recommendations/page.tsx` contains the UI.
    - The `HealthForm` component (`src/components/recommendations/health-form.tsx`) collects user's age and health conditions.
    - On submission, it calls the `getHealthRecommendation` server action, which in turn runs the `personalizedHealthRecommendations` Genkit flow (`src/ai/flows/personalized-health-recommendations.ts`).
    - The flow uses a predefined logic tree to generate advice based on AQI level and user sensitivity.

### 4.4. Health Journal (`/health-journal`)
- **Description**: Allows users to track daily symptoms and correlate them with local air quality.
- **Implementation**:
    - `src/app/(app)/health-journal/page.tsx` orchestrates the `HealthLogForm` and `HealthLogList` components.
    - The `useHealthLog` hook (`src/hooks/use-health-log.ts`) manages storing and retrieving journal entries from the browser's `localStorage`.
    - Users can log symptoms, and the entry is timestamped and saved with the current AQI for future reference.

### 4.5. Carbon Footprint Calculator (`/carbon-footprint`)
- **Description**: An interactive tool to estimate a user's annual carbon footprint and track their progress.
- **Implementation**:
    - `src/app/(app)/carbon-footprint/page.tsx` contains the `CalculatorForm`.
    - The form in `src/components/carbon-footprint/calculator-form.tsx` collects detailed lifestyle information (energy use, transport, diet, waste).
    - It calls the `calculateCarbonFootprint` flow (`src/ai/flows/carbon-footprint-calculator.ts`) which uses a set of emission factors to calculate the total footprint and generate personalized reduction tips.
    - The `useFootprintHistory` hook (`src/hooks/use-footprint-history.ts`) saves calculation results to `localStorage` to power a progress chart.

### 4.6. Eco-Map (`/eco-map`)
- **Description**: A crowdsourced map where users can report environmental issues like illegal trash dumping.
- **Implementation**:
    - `src/app/(app)/eco-map/page.tsx` displays the map and reporting form.
    - The `EcoMap` component (`src/components/eco-map/eco-map.tsx`) shows a static map image with pins representing reports.
    - The `ReportForm` (`src/components/eco-map/report-form.tsx`) allows users to submit a new issue.
    - On submission, the `submitReport` server action is called. This action first uses the `classifyReportSeverity` Genkit flow to determine the issue's severity.
    - The new report, including its severity, is then saved to the `reports` collection in Firebase Firestore.
    - The `useEcoReports` hook (`src/hooks/use-eco-reports.ts`) provides a real-time stream of reports from Firestore to display on the map.

### 4.7. Eco-Challenges & Leaderboard (`/challenges`)
- **Description**: A gamified system where users can complete environmental challenges to earn points and badges.
- **Implementation**:
    - `src/app/(app)/challenges/page.tsx` lays out the different components.
    - `ChallengeList`: Displays available challenges from `src/lib/data.ts`.
    - `Leaderboard`: Shows a ranked list of users. The current user's score is updated dynamically.
    - `MyBadges`: Displays badges unlocked by reaching score milestones.
    - `useUserScore` hook (`src/hooks/use-user-score.ts`) and `useUserChallenges` hook (`src/hooks/use-user-challenges.ts`) manage the user's progress using `localStorage`.

### 4.8. Educational Content (`/education`)
- **Description**: A section with AI-curated articles on key environmental topics.
- **Implementation**:
    - `src/app/(app)/education/page.tsx` uses a tabbed interface to switch between topics.
    - The content for each topic is fetched from the `getEducationalContent` flow (`src/ai/flows/educational-content.ts`), which currently returns mock data.

## 5. Authentication

- **Provider**: Firebase Authentication.
- **Methods**: Email/Password.
- **Implementation**:
    - `src/app/login/page.tsx` and `src/app/signup/page.tsx` provide the UI for authentication.
    - The `useUser` hook (`src/firebase/provider.tsx`) provides the current user's auth state throughout the app.
    - `AuthLayout` (`src/components/auth-layout.tsx`) is a client component that wraps all authenticated routes and redirects to `/login` if no user is signed in.
    - `AuthWatcher` (`src/components/auth-watcher.tsx`) is used on login/signup pages to redirect already authenticated users to the dashboard.

## 6. API Usage

The application relies on several external and internal APIs.

- **`/api/air-quality`**: A server-side proxy that fetches AQI data from the **Open-Meteo Air Quality API**. It simplifies the client-side request and protects the underlying API URL.
- **`/api/reverse-geo`**: A server-side proxy that uses the **OpenWeatherMap Geocoding API** to convert latitude/longitude into a city name. Requires `NEXT_PUBLIC_OPENWEATHER_API_KEY`.
- **NASA FIRMS API**: Used in the Hazard Map to fetch active wildfire data. Requires `NEXT_PUBLIC_NASA_API_KEY`.
- **OpenAQ API**: Used in the Hazard Map to fetch data from air quality monitoring stations. Requires `NEXT_PUBLIC_OPENAQ_API_KEY`.
